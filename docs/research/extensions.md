<!-- Generated By: Cursor (GPT-5) -->

## GNOME Shell extensions: manual install and enable via DBus

This document provides a manual, no-sudo sequence to install and enable a GNOME Shell extension without popups, using GNOME Shell's DBus API. Example extension: Quick Close in Overview (id 352).

### Optional: validate the links
```bash
curl -I -L 'https://www.reddit.com/r/gnome/comments/rbl85n/installing_gnomeshell_extensions_on_command_line/'
curl -I -L 'https://discourse.gnome.org/t/enable-gnome-extensions-without-session-restart/7936/4'
curl -I -L 'https://extensions.gnome.org/extension/352/middle-click-to-close-in-overview/'
```

### Pre-flight checks
```bash
# Confirm GNOME Shell session
gnome-shell --version

# Verify GNOME Shell Extensions DBus API is available
gdbus introspect --session --dest org.gnome.Shell.Extensions --object-path /org/gnome/Shell/Extensions | head -n 20 | cat

# Ensure user extensions are enabled
gsettings get org.gnome.shell disable-user-extensions
# If this prints 'true':
# gsettings set org.gnome.shell disable-user-extensions false
```

### Get the correct extension UUID for your Shell version (id 352)
```bash
# Extract major Shell version (e.g., 47 from "GNOME Shell 47.3")
SHELL_VER="$(gnome-shell --version | awk '{print $3}' | cut -d. -f1)"

# Fetch UUID from extensions.gnome.org API (id=352 Quick Close in Overview)
# Preferred (needs jq):
UUID="$(curl -fsSL "https://extensions.gnome.org/extension-info/?pk=352&shell_version=${SHELL_VER}" | jq -r '.uuid')"

# Fallback if jq is unavailable:
# UUID="$(curl -fsSL "https://extensions.gnome.org/extension-info/?pk=352&shell_version=${SHELL_VER}" | python3 -c 'import sys, json; print(json.load(sys.stdin)["uuid"])')"

echo "UUID=${UUID}"
```

### Install via GNOME Shell (no popup)
```bash
gdbus call --session \
  --dest org.gnome.Shell.Extensions \
  --object-path /org/gnome/Shell/Extensions \
  --method org.gnome.Shell.Extensions.InstallRemoteExtension \
  "${UUID}"

# Inspect installed extension (optional)
gnome-extensions info "${UUID}" || true
```

### Enable immediately
```bash
gnome-extensions enable "${UUID}"

# Verify enabled
gnome-extensions list --enabled | grep -F "${UUID}" || echo "Not enabled"
```

### Rollback (disable/uninstall)
```bash
gnome-extensions disable "${UUID}" || true
gnome-extensions uninstall "${UUID}" || true
```

### Fallback (if the gnome-extensions CLI is missing)
```bash
# Read current enabled extensions
gsettings get org.gnome.shell enabled-extensions

# Append UUID and write back (no sudo)
UUID="${UUID}" \
gsettings set org.gnome.shell enabled-extensions "$(gsettings get org.gnome.shell enabled-extensions | python3 -c 'import ast,sys,os; a=ast.literal_eval(sys.stdin.read()); u=os.getenv("UUID"); print(str(a+[u] if u not in a else a).replace("'","\""))')"
```

### GNOME 48 behavior and manual install (no popup)

- In GNOME 48, calling `InstallRemoteExtension` via DBus prompts with a confirmation dialog; non-interactive install is not supported. The error `org.freedesktop.DBus.Error.NoReply` indicates the shell is waiting on that dialog. Reference: [GNOME Discourse](https://discourse.gnome.org/t/enable-gnome-extensions-without-session-restart/7936/4).
- If you want a silent path without the prompt, download the Zip from `extensions.gnome.org` and install it with the CLI. This still installs as a user extension and can get updates.

```bash
# Resolve UUID and download URL for your Shell major version (e.g., 48)
SHELL_VER="$(gnome-shell --version | awk '{print $3}' | cut -d. -f1)"
INFO_JSON="$(curl -fsSL "https://extensions.gnome.org/extension-info/?pk=352&shell_version=${SHELL_VER}")"
UUID="$(printf '%s' "$INFO_JSON" | jq -r '.uuid')"
DURL="$(printf '%s' "$INFO_JSON" | jq -r '.download_url')"
ZIP="/tmp/${UUID}.zip"
curl -fLo "$ZIP" "https://extensions.gnome.org${DURL}"

# Preferred: install with the built-in CLI (no prompt)
gnome-extensions install --force "$ZIP"
gnome-extensions enable "$UUID"
gnome-extensions info "$UUID" || true
gnome-extensions list --enabled | grep -F "$UUID" || echo "Not enabled"

# Fallback if the CLI is missing
mkdir -p "$HOME/.local/share/gnome-shell/extensions"
unzip -q -o "$ZIP" -d "$HOME/.local/share/gnome-shell/extensions/"

# Enable via gsettings if needed
gsettings set org.gnome.shell enabled-extensions "$(gsettings get org.gnome.shell enabled-extensions | python3 -c 'import ast,sys,os; a=ast.literal_eval(sys.stdin.read()); u=os.getenv("UUID"); print(str(a+[u] if u not in a else a).replace("'","\""))')"
```

Notes:
- Wayland sessions don’t support `Alt+F2` → `r`. If hot-load fails, log out/in.
- GNOME upstream notes that “sideloaded” installs (copying files) aren’t officially supported for hot-loading; new extensions are registered when installed via `InstallRemoteExtension`. Reference: [Proper way to restart the shell](https://discourse.gnome.org/t/proper-way-to-restart-the-shell-from-a-script/9797/4).

### Updates after manual install

- GNOME Shell checks for user extension updates and can notify you; disabling those notifications is discussed here (evidence of built-in checks): [Unix.SE](https://unix.stackexchange.com/questions/747597/how-to-disable-extension-manager-updates-notification).
- If you install the Zip from `extensions.gnome.org`, the UUID/version come from upstream and the extension remains eligible for updates. You can also manage updates from the command line with third-party tools:
  - `gnome-extensions-cli` (`gext`) can install/update/enable/disable; it supports both DBus and filesystem backends and can update all extensions: [Linux Uprising](https://www.linuxuprising.com/2023/02/search-install-and-update-gnome-shell.html), [GitHub](https://github.com/essembeh/gnome-extensions-cli).
  - `gnome-shell-extension-installer` supports `--update` to update all: [Ask Ubuntu](https://askubuntu.com/questions/937284/how-can-i-update-gnome-shell-extensions-from-the-command-line).

Recommendation:
- Accept the one-time DBus prompt on fresh systems to let GNOME register the extension, or install the Zip via `gnome-extensions install` from `extensions.gnome.org` and rely on built-in checks or one of the CLIs above for updates.

### Troubleshooting: zip install not detected (GNOME 48)

Symptom: `gnome-extensions enable <uuid>` reports “does not exist” after installing the downloaded zip.

Steps to force registration and enablement:
```bash
# Confirm UUID and metadata inside the zip you downloaded
unzip -p "/tmp/middleclickclose@paolo.tranquilli.gmail.com.zip" metadata.json | jq -r '.uuid,.name,.version'

# Install into the exact UUID directory under user extensions
mkdir -p "$HOME/.local/share/gnome-shell/extensions/middleclickclose@paolo.tranquilli.gmail.com"
unzip -q -o "/tmp/middleclickclose@paolo.tranquilli.gmail.com.zip" -d "$HOME/.local/share/gnome-shell/extensions/middleclickclose@paolo.tranquilli.gmail.com"

# Verify files
ls -la "$HOME/.local/share/gnome-shell/extensions/middleclickclose@paolo.tranquilli.gmail.com"

# Register the extension:
# - Wayland: logout/login is most reliable
# - X11: Alt+F2, type r, Enter

# After re-login (or restart on X11), enable and verify
gnome-extensions enable "middleclickclose@paolo.tranquilli.gmail.com" || true
gnome-extensions info "middleclickclose@paolo.tranquilli.gmail.com" || true
gnome-extensions list --enabled | grep -F "middleclickclose@paolo.tranquilli.gmail.com" || echo "Not enabled yet (try re-login)"
```

Notes:
- If `gnome-extensions install --force <zip>` produced no output and the UUID isn’t found, manual placement as above plus session restart typically resolves it.
- Sideloaded installs are registered at session start; GNOME notes new extensions are auto-registered only when installed via `InstallRemoteExtension` DBus. Reference: [GNOME Discourse](https://discourse.gnome.org/t/proper-way-to-restart-the-shell-from-a-script/9797/4).

### Session restart options (Wayland vs X11)

```bash
echo "Session: ${XDG_SESSION_TYPE}"
```

- Wayland: there’s no official programmatic shell restart; logging out/in is the supported method. Attempting DBus `Eval` will return a safe-mode response and won’t restart. Reference: [GNOME Discourse](https://discourse.gnome.org/t/proper-way-to-restart-the-shell-from-a-script/9797/4).
- X11: you can restart the shell without ending the session:
  - UI: press Alt+F2, type `r`, press Enter.
  - DBus (when allowed):
    ```bash
    busctl --user call org.gnome.Shell /org/gnome/Shell org.gnome.Shell Eval s 'Meta.restart("Restarting…")'
    ```
  - Or from a terminal: `gnome-shell --replace` (will block that terminal; usually run from a different TTY).

On Wayland, prefer logout/login after installing a new extension by copying files, then run the enable/verify commands.

### CLI management with gext (gnome-extensions-cli)

Install the unofficial CLI and manage extensions non-interactively (DBus or filesystem backends):
```bash
# Install (pipx recommended)
pipx install gnome-extensions-cli --system-site-packages

# Examples
gext install 352          # by package id
gext install "${UUID}"     # by uuid
gext enable  "${UUID}"
gext update               # update all enabled extensions
gext list -a              # list all (enabled+disabled)
```
Reference: [Super User](https://superuser.com/questions/1691843/install-gnome-shell-extension-on-command-line), [Linux Uprising](https://www.linuxuprising.com/2023/02/search-install-and-update-gnome-shell.html), [gnome-extensions-cli GitHub](https://github.com/essembeh/gnome-extensions-cli).

Related project docs (shell restart/use cases you may have already documented): [AI Status Indicators extension](https://github.com/jewzaam/gnome-extension-ai-status-indicators).

### References
- Discourse: Enable GNOME Extensions without session restart — InstallRemoteExtension example: [GNOME Discourse](https://discourse.gnome.org/t/enable-gnome-extensions-without-session-restart/7936/4)
- Extension page (Quick Close in Overview, id 352): [GNOME Extensions](https://extensions.gnome.org/extension/352/middle-click-to-close-in-overview/)
- Background discussion: [Reddit](https://www.reddit.com/r/gnome/comments/rbl85n/installing_gnomeshell_extensions_on_command_line/)
 - GNOME sideloading + registration behavior: [GNOME Discourse](https://discourse.gnome.org/t/proper-way-to-restart-the-shell-from-a-script/9797/4)
 - Update checks and disabling notifications: [Unix.SE](https://unix.stackexchange.com/questions/747597/how-to-disable-extension-manager-updates-notification)
 - CLI updates: [Linux Uprising](https://www.linuxuprising.com/2023/02/search-install-and-update-gnome-shell.html), [Ask Ubuntu](https://askubuntu.com/questions/937284/how-can-i-update-gnome-shell-extensions-from-the-command-line)


---
# Generated By: Cursor (Claude Sonnet 4)
# System configuration tasks

- name: Check if GNOME is available
  ansible.builtin.command: which gnome-shell
  register: system_config_gnome_check
  failed_when: false
  changed_when: false

- name: GNOME configuration block
  when: system_config_gnome_check.rc == 0
  block:
    - name: Disable idle activation for screensaver
      community.general.dconf:
        key: "/org/gnome/desktop/screensaver/idle-activation-enabled"
        value: "false"
        state: present

    - name: Set session idle delay to never (0)
      community.general.dconf:
        key: "/org/gnome/desktop/session/idle-delay"
        value: "uint32 0"
        state: present

    - name: Disable automatic suspend
      community.general.dconf:
        key: "/org/gnome/settings-daemon/plugins/power/sleep-inactive-ac-type"
        value: "'nothing'"
        state: present

    - name: Enable lock on manual suspend/screensaver (security)
      community.general.dconf:
        key: "/org/gnome/desktop/screensaver/lock-enabled"
        value: "true"
        state: present

    - name: Set immediate lock when screensaver activates
      community.general.dconf:
        key: "/org/gnome/desktop/screensaver/lock-delay"
        value: "uint32 0"
        state: present

    # Performance optimization settings
    - name: Disable GNOME animations for better performance
      community.general.dconf:
        key: "/org/gnome/desktop/interface/enable-animations"
        value: "false"
        state: present

    - name: Disable GTK animations for better performance
      community.general.dconf:
        key: "/org/gnome/desktop/interface/gtk-enable-animations"
        value: "false"
        state: present

    - name: Set font antialiasing to grayscale for better remote performance
      community.general.dconf:
        key: "/org/gnome/desktop/interface/font-antialiasing"
        value: "'grayscale'"
        state: present

    - name: Set font hinting to slight for better remote performance
      community.general.dconf:
        key: "/org/gnome/desktop/interface/font-hinting"
        value: "'slight'"
        state: present

    - name: Disable desktop icons for cleaner experience
      community.general.dconf:
        key: "/org/gnome/desktop/background/show-desktop-icons"
        value: "false"
        state: present

    # Terminal performance optimizations (for default profile)
    - name: Check if gnome-terminal is installed
      ansible.builtin.command: which gnome-terminal
      register: system_config_gnome_terminal_check
      failed_when: false
      changed_when: false

    - name: Get default GNOME Terminal profile (via dconf)
      ansible.builtin.shell: |
        set -o pipefail
        dconf read /org/gnome/terminal/legacy/profiles:/default | tr -d "' "
      register: system_config_terminal_profile
      failed_when: false
      changed_when: false
      when: system_config_gnome_terminal_check.rc == 0

    - name: Disable GNOME Terminal transparency for better performance
      community.general.dconf:
        key: "/org/gnome/terminal/legacy/profiles:/:{{ system_config_terminal_profile.stdout }}/use-transparent-background"
        value: "false"
        state: present
      when:
        - system_config_gnome_terminal_check.rc == 0
        - system_config_terminal_profile.rc == 0
        - system_config_terminal_profile.stdout != ""

- name: GNOME not available warning
  ansible.builtin.debug:
    msg: "WARNING: GNOME not detected. Screen lock settings skipped."
  when: system_config_gnome_check.rc != 0

- name: Ensure dconf database is updated
  ansible.builtin.command: dconf update
  changed_when: true
  when: system_config_gnome_check.rc == 0
  failed_when: false  # Allow to fail since user settings don't require system db updates

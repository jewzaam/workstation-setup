# VM Workstation Setup Ansible Playbook
<!-- Generated By: Cursor (Claude Sonnet 4) -->

## Overview
Automated VM workstation setup using Ansible. Installs packages, deploys files, and configures system settings for optimal remote access.

## Requirements
- Fedora/RHEL/CentOS VM (Red Hat family)
- Ansible installed (`sudo dnf install ansible`)
- ansible-lint installed for lint target (`pip3 install --user -r requirements-dev.txt`)
- Root/sudo access
- Internet connection for package downloads

## Quick Start

1. **Clone this repository on the VM:**
   ```bash
   git clone <repository-url>
   cd workstation-setup/ansible
   ```

2. **Run the complete setup:**
   ```bash
   ansible-playbook -i localhost, -c local site.yml --ask-become-pass
   ```

3. **Run with config selections:**
   ```bash
   # Use the top-level Makefile flow
   make configure
   make run
   ```

## What Gets Installed

### Packages
- **Essential tools**: python3, git, vim, screen, curl, wget
- **Development**: golang, meld, tig
- **Cursor**: AI-powered code editor (AppImage)

### Files Deployed
- `.bashrc` - Custom bash configuration with Go environment
- `.bashrc_prompt` - Color prompt configuration
- `.vimrc` - Vim editor configuration with Ruby/YAML support
- `.screenrc` - GNU Screen configuration
- `bin/trim` - Utility script to remove trailing whitespace from files
  (Git configuration is applied via Ansible modules)

#### Using the trim utility
```bash
# Remove trailing whitespace from a file
~/bin/trim myfile.txt

# Usage: trim <filename>
# Edits files in-place to remove trailing spaces and tabs
```

### System Configuration
- **Screen lock disabled** - Prevents VM from locking during remote sessions
- **Idle activation disabled** - Keeps VM active
- **Suspend disabled** - Prevents automatic sleep

## GNOME Extensions

This playbook can install user-level GNOME Shell extensions via the `gnome_extensions` role. It downloads the official zips from `extensions.gnome.org`, extracts to `~/.local/share/gnome-shell/extensions/<uuid>/`, and optionally enables them. On Wayland, a logout/login is typically required for the shell to register newly added extensions.

Configure the list in `group_vars/all.yml` under `gnome_extensions_install_list`. See `docs/research/extensions.md` for manual commands and troubleshooting.

## File Structure
```
ansible/
├── site.yml                    # Main playbook
├── group_vars/all.yml          # Configuration variables
└── roles/
    ├── packages/tasks/main.yml     # Package installation
    ├── files/                      # File deployment
    │   ├── tasks/main.yml
    │   └── files/                  # Source dotfiles (no dot prefix)
    │       ├── bashrc
    │       ├── bashrc_prompt
    │       ├── vimrc
    │       ├── screenrc
    │       ├── bin/
    │       │   └── trim            # Script to remove trailing whitespace
    │       └── gitconfig
    └── system-config/tasks/main.yml # System settings
```

## Customization

Edit `group_vars/all.yml` to customize:
- Package lists
- Cursor installation method
- File permissions
- Extension URLs

## Validation

The playbook includes validation checks:
- ✅ Package installation verification
- ✅ Dotfile dependency validation
- ✅ GNOME extension status reporting
- ✅ File deployment confirmation

## Troubleshooting

**Permission errors:**
```bash
# Ensure you have sudo access
sudo -v
```

**GNOME not detected:**
- Playbook will skip GNOME settings on non-GNOME systems
- Manual `gsettings` commands may be needed

**Go environment issues:**
- Logout/login after installation to refresh environment
- Check with: `go version`

**Cursor not launching:**
- Verify AppImage permissions: `ls -la /opt/cursor/`
- Try: `/opt/cursor/cursor.AppImage`